description "Microsoft Azure Linux agent"
author "Ben Howard <ben.howard@canonical.com>"

start on runlevel [2345]
stop on runlevel [!2345]

pre-start script

    [ -r /etc/default/walinuxagent ] && . /etc/default/walinuxagent

    if [ "$WALINUXAGENT_ENABLED" != "1" ]; then
        stop ; exit 0
    fi

    if [ ! -x /usr/sbin/waagent ]; then
        stop ; exit 0
    fi

    mkdir -p -m0755 /var/run/walinuxagent
    chown waagent:waagent /var/run/walinuxagent
end script

exec start-stop-daemon --start --chuid waagent --user waagent --group waagent --exec /usr/sbin/waagent -- -daemon
